---
import Cart from '../components/Cart.astro';
import WhatsAppBtn from '../components/WhatsAppBtn.astro';
import CookieManager from '../components/CookieManager.astro';

import '@fontsource/inter/300.css';
import '@fontsource/inter/400.css';
import '@fontsource/inter/600.css';
import '@fontsource-variable/playfair-display';

interface Props {
	title: string;
	description?: string;
	image?: string;
    noindex?: boolean;
    schema?: string; 
}

const { 
    title, 
    description = "Siempre Divinas, tienda online de ropa, calzado y complementos para mujer. Moda diaria, buena calidad y precios asequibles. Compra online fácil y segura.", 
    image = "/img/logo.png", 
    noindex = false,
    schema
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteUrl = Astro.site ? Astro.site.toString() : 'https://siempredivinas.com/';
const logoUrl = new URL('/img/logo.png', siteUrl).toString();
---

<!doctype html>
<html lang="es" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
        <link rel="preload" as="image" href="/img/home-bg.webp" fetchpriority="high" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
        
		<title>{title} | Siempre Divinas</title>
        <meta name="description" content={description} />
        <link rel="canonical" href={canonicalURL} />
        
        {noindex ? (
            <meta name="robots" content="noindex, nofollow" />
        ) : (
            <meta name="robots" content="index, follow" />
        )}

        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={new URL(image, siteUrl)} />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:type" content="website" />
        <meta property="og:site_name" content="Siempre Divinas" />
        <meta property="og:locale" content="es_ES" />

        <script type="application/ld+json" set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": "Siempre Divinas",
            "url": siteUrl,
            "potentialAction": {
                "@type": "SearchAction",
                "target": `${siteUrl}?q={search_term_string}`,
                "query-input": "required name=search_term_string"
            }
        })} />

        <script type="application/ld+json" set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "OnlineStore",
            "name": "Siempre Divinas",
            "image": logoUrl,
            "@id": siteUrl,
            "url": siteUrl,
            "telephone": "+34681883707",
            "email": "info@siempredivinas.com",
            "founder": {
                "@type": "Person",
                "name": "Ana María Diaz Labella"
            },
            
        })} />

        {schema && <script type="application/ld+json" set:html={schema} />}
	</head>
	
    <body class="bg-white text-gray-900 flex flex-col min-h-screen font-sans">
        
        <header class="bg-white shadow-md sticky top-0 z-50 font-sans relative">
            <nav class="container mx-auto px-4 py-4 md:py-6 flex items-center justify-between">
                
                <div class="flex-1 flex justify-start">
                    <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-700 hover:text-pink-600 focus:outline-none" aria-label="Abrir menú de navegación">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <div class="hidden md:block"></div>
                </div>

                <a href="/" class="flex-shrink-0 transform hover:scale-105 transition duration-500" aria-label="Ir a la página de inicio">
                    <img 
                        src="/img/logo.png" 
                        alt="Siempre Divinas" 
                        class="h-16 w-auto md:h-24 drop-shadow-sm" 
                        width="300"
                        height="96"
                    />
                </a>

                <div class="flex-1 flex justify-end items-center gap-6">
                    
                    <div class="hidden md:flex items-center gap-8 font-medium text-gray-700 uppercase tracking-wider text-sm">
                        <a href="/" class="hover:text-pink-600 transition relative group py-2">
                            Inicio
                            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-pink-600 transition-all duration-300 group-hover:w-full"></span>
                        </a>
                        <a href="/#catalogo" class="hover:text-pink-600 transition relative group py-2">
    Catálogo
    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-pink-600 transition-all duration-300 group-hover:w-full"></span>
</a>
                        <a href="/contacto" class="hover:text-pink-600 transition relative group py-2">
                            Contacto
                            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-pink-600 transition-all duration-300 group-hover:w-full"></span>
                        </a>
                    </div>

                    <button 
                        onclick="window.dispatchEvent(new Event('toggle-cart'))" 
                        class="relative group p-2 hover:bg-gray-100 rounded-full transition"
                        aria-label="Abrir carrito de compra"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-800 group-hover:text-pink-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                        <span class="cart-count-badge absolute -top-1 -right-1 bg-pink-600 text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full hidden shadow-md border-2 border-white">0</span>
                    </button>

                </div>
            </nav>

            <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-white shadow-lg border-t border-gray-100 flex flex-col animate-fade-in-down z-40">
                <a href="/" class="block px-6 py-4 text-gray-800 hover:bg-pink-50 hover:text-pink-600 border-b border-gray-100 font-medium transition">
                    Inicio
                </a>
                <a href="/#catalogo" class="block px-6 py-4 text-gray-800 hover:bg-pink-50 hover:text-pink-600 border-b border-gray-100 font-medium transition">
    Catálogo
</a>
                <a href="/contacto" class="block px-6 py-4 text-gray-800 hover:bg-pink-50 hover:text-pink-600 font-medium transition">
                    Contacto
                </a>
            </div>

        </header>

        <slot />

        <footer class="bg-black text-white py-10 mt-auto">
            <div class="container mx-auto px-4 text-center">
                <p class="font-serif text-xl mb-6">Siempre Divinas</p>
                
                <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-sm text-gray-400 mb-6">
                    <a href="/legal/aviso-legal" class="hover:text-white transition">Aviso Legal</a>
                    <a href="/legal/condiciones-compra" class="hover:text-white transition">Condiciones de Compra</a>
                    <a href="/legal/politica-privacidad" class="hover:text-white transition">Privacidad</a>
                    <a href="/legal/politica-cookies" class="hover:text-white transition">Cookies</a>
                </div>
                
                <p class="text-xs text-gray-400">© 2026 Siempre Divinas | Rivas Vaciamadrid</p>
            </div>
        </footer>

        <WhatsAppBtn />
        <CookieManager />

        <Cart />
        
        <script>
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');

            if (btn && menu) {
                btn.addEventListener('click', () => {
                    menu.classList.toggle('hidden');
                });

                // Cerrar menú al hacer clic en un enlace
                menu.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        menu.classList.add('hidden');
                    });
                });
            }
        </script>
        <style is:global>
          html {
            scroll-behavior: smooth; /* Hace que el salto al catálogo sea fluido, no brusco */
          }
          #catalogo {
            scroll-margin-top: 6rem; /* Deja un espacio de seguridad para que el menú fijo no tape el título "Explora tu Catálogo" */
          }
        </style>
    </body>
</html>